{"version":3,"file":"index.js","sources":["../../../../src/util/dom/layout/getStackingContext.js"],"sourcesContent":["/**\r\n * Recursive function that finds the closest parent stacking context.\r\n * See also https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context\r\n *\r\n * Original author: Kerry Liu / https://github.com/gwwar\r\n *\r\n * @see https://github.com/gwwar/z-context/blob/master/content-script.js\r\n * @see https://github.com/gwwar/z-context/blob/master/LICENSE\r\n *\r\n * @param {Element} node -\r\n *\r\n * @param {Window} [activeWindow=globalThis] The target active window as applicable.\r\n *\r\n * @returns {StackingContext | undefined} The closest parent stacking context or undefined if none.\r\n *\r\n */\r\nexport function getStackingContext(node, activeWindow = globalThis)\r\n{\r\n   const activeDocument = activeWindow.document;\r\n\r\n   // the root element (HTML).\r\n   if (!node || node.nodeName === 'HTML')\r\n   {\r\n      return { node: activeDocument.documentElement, reason: 'root' };\r\n   }\r\n\r\n   // handle shadow root elements.\r\n   if (node.nodeName === '#document-fragment')\r\n   {\r\n      return getStackingContext(node.host);\r\n   }\r\n\r\n   const computedStyle = activeWindow.getComputedStyle(node);\r\n\r\n   // position: fixed or sticky.\r\n   if (computedStyle.position === 'fixed' || computedStyle.position === 'sticky')\r\n   {\r\n      return { node, reason: `position: ${computedStyle.position}` };\r\n   }\r\n\r\n   // positioned (absolutely or relatively) with a z-index value other than \"auto\".\r\n   if (computedStyle.zIndex !== 'auto' && computedStyle.position !== 'static')\r\n   {\r\n      return { node, reason: `position: ${computedStyle.position}; z-index: ${computedStyle.zIndex}` };\r\n   }\r\n\r\n   // elements with an opacity value less than 1.\r\n   if (computedStyle.opacity !== '1')\r\n   {\r\n      return { node, reason: `opacity: ${computedStyle.opacity}` };\r\n   }\r\n\r\n   // elements with a transform value other than \"none\".\r\n   if (computedStyle.transform !== 'none')\r\n   {\r\n      return { node, reason: `transform: ${computedStyle.transform}` };\r\n   }\r\n\r\n   // elements with a mix-blend-mode value other than \"normal\".\r\n   if (computedStyle.mixBlendMode !== 'normal')\r\n   {\r\n      return { node, reason: `mixBlendMode: ${computedStyle.mixBlendMode}` };\r\n   }\r\n\r\n   // elements with a filter value other than \"none\".\r\n   if (computedStyle.filter !== 'none')\r\n   {\r\n      return { node, reason: `filter: ${computedStyle.filter}` };\r\n   }\r\n\r\n   // elements with a perspective value other than \"none\".\r\n   if (computedStyle.perspective !== 'none')\r\n   {\r\n      return { node, reason: `perspective: ${computedStyle.perspective}` };\r\n   }\r\n\r\n   // elements with a clip-path value other than \"none\".\r\n   if (computedStyle.clipPath !== 'none')\r\n   {\r\n      return { node, reason: `clip-path: ${computedStyle.clipPath} ` };\r\n   }\r\n\r\n   // elements with a mask value other than \"none\".\r\n   const mask = computedStyle.mask || computedStyle.webkitMask;\r\n   if (mask !== 'none' && mask !== undefined)\r\n   {\r\n      return { node, reason: `mask:  ${mask}` };\r\n   }\r\n\r\n   // elements with a mask-image value other than \"none\".\r\n   const maskImage = computedStyle.maskImage || computedStyle.webkitMaskImage;\r\n   if (maskImage !== 'none' && maskImage !== undefined)\r\n   {\r\n      return { node, reason: `mask-image: ${maskImage}` };\r\n   }\r\n\r\n   // elements with a mask-border value other than \"none\".\r\n   const maskBorder = computedStyle.maskBorder || computedStyle.webkitMaskBorder;\r\n   if (maskBorder !== 'none' && maskBorder !== undefined)\r\n   {\r\n      return { node, reason: `mask-border: ${maskBorder}` };\r\n   }\r\n\r\n   // elements with isolation set to \"isolate\".\r\n   if (computedStyle.isolation === 'isolate')\r\n   {\r\n      return { node, reason: `isolation: ${computedStyle.isolation}` };\r\n   }\r\n\r\n   // transform or opacity in will-change even if you don't specify values for these attributes directly.\r\n   if (computedStyle.willChange === 'transform' || computedStyle.willChange === 'opacity')\r\n   {\r\n      return { node, reason: `willChange: ${computedStyle.willChange}` };\r\n   }\r\n\r\n   // elements with -webkit-overflow-scrolling set to \"touch\".\r\n   if (computedStyle.webkitOverflowScrolling === 'touch')\r\n   {\r\n      return { node, reason: '-webkit-overflow-scrolling: touch' };\r\n   }\r\n\r\n   // an item with a z-index value other than \"auto\".\r\n   if (computedStyle.zIndex !== 'auto')\r\n   {\r\n      const parentStyle = activeWindow.getComputedStyle(node.parentNode);\r\n      // with a flex|inline-flex parent.\r\n      if (parentStyle.display === 'flex' || parentStyle.display === 'inline-flex')\r\n      {\r\n         return { node, reason: `flex-item; z-index: ${computedStyle.zIndex}` };\r\n         // with a grid parent.\r\n      }\r\n      else if (parentStyle.grid !== 'none / none / none / row / auto / auto')\r\n      {\r\n         return { node, reason: `child of grid container; z-index: ${computedStyle.zIndex}` };\r\n      }\r\n   }\r\n\r\n   // contain with a value of layout, or paint, or a composite value that includes either of them\r\n   const contain = computedStyle.contain;\r\n   if (['layout', 'paint', 'strict', 'content'].indexOf(contain) > -1 ||\r\n    contain.indexOf('paint') > -1 ||\r\n    contain.indexOf('layout') > -1\r\n   )\r\n   {\r\n      return { node, reason: `contain: ${contain}` };\r\n   }\r\n\r\n   return getStackingContext(node.parentNode);\r\n}\r\n\r\n/**\r\n * @typedef {object} StackingContext\r\n *\r\n * @property {Element} node - A DOM Element.\r\n *\r\n * @property {string}  reason - Reason for why a stacking context was created.\r\n */\r\n"],"names":[],"mappings":"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"}