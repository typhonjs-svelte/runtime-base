{"version":3,"file":"index.js","sources":["../../../../src/util/dom/layout/getStackingContext.ts","../../../../src/util/dom/layout/elementMatchesFilter.ts","../../../../src/util/dom/layout/findParentElement.ts"],"sourcesContent":["import { CrossRealm } from '#runtime/util/realm';\r\n\r\n/**\r\n * Recursive function that finds the closest parent stacking context.\r\n * See also https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context\r\n *\r\n * Original author: Kerry Liu / https://github.com/gwwar\r\n *\r\n * @see https://github.com/gwwar/z-context/blob/master/content-script.js\r\n * @see https://github.com/gwwar/z-context/blob/master/LICENSE\r\n *\r\n * @param {Element} node -\r\n *\r\n * @param [activeWindow] The target active window as applicable.\r\n *\r\n * @returns The closest parent stacking context or undefined if none.\r\n *\r\n */\r\nexport function getStackingContext(node: Element, activeWindow: Window = window): StackingContext\r\n{\r\n   const activeDocument = activeWindow.document;\r\n\r\n   // The root element (HTML).\r\n   if (!node || node.nodeName === 'HTML')\r\n   {\r\n      return { node: activeDocument.documentElement, reason: 'root' };\r\n   }\r\n\r\n   // Handle shadow root elements.\r\n   if (CrossRealm.browser.isShadowRoot(node)) // node.nodeName === '#document-fragment')\r\n   {\r\n      return getStackingContext((node as ShadowRoot).host, activeWindow);\r\n   }\r\n\r\n   const computedStyle = activeWindow.getComputedStyle(node);\r\n\r\n   // position: fixed or sticky.\r\n   if (computedStyle.position === 'fixed' || computedStyle.position === 'sticky')\r\n   {\r\n      return { node, reason: `position: ${computedStyle.position}` };\r\n   }\r\n\r\n   // positioned (absolutely or relatively) with a z-index value other than \"auto\".\r\n   if (computedStyle.zIndex !== 'auto' && computedStyle.position !== 'static')\r\n   {\r\n      return { node, reason: `position: ${computedStyle.position}; z-index: ${computedStyle.zIndex}` };\r\n   }\r\n\r\n   // elements with an opacity value less than 1.\r\n   if (computedStyle.opacity !== '1')\r\n   {\r\n      return { node, reason: `opacity: ${computedStyle.opacity}` };\r\n   }\r\n\r\n   // elements with a transform value other than \"none\".\r\n   if (computedStyle.transform !== 'none')\r\n   {\r\n      return { node, reason: `transform: ${computedStyle.transform}` };\r\n   }\r\n\r\n   // elements with a mix-blend-mode value other than \"normal\".\r\n   if (computedStyle.mixBlendMode !== 'normal')\r\n   {\r\n      return { node, reason: `mixBlendMode: ${computedStyle.mixBlendMode}` };\r\n   }\r\n\r\n   // elements with a filter value other than \"none\".\r\n   if (computedStyle.filter !== 'none')\r\n   {\r\n      return { node, reason: `filter: ${computedStyle.filter}` };\r\n   }\r\n\r\n   // elements with a perspective value other than \"none\".\r\n   if (computedStyle.perspective !== 'none')\r\n   {\r\n      return { node, reason: `perspective: ${computedStyle.perspective}` };\r\n   }\r\n\r\n   // elements with a clip-path value other than \"none\".\r\n   if (computedStyle.clipPath !== 'none')\r\n   {\r\n      return { node, reason: `clip-path: ${computedStyle.clipPath} ` };\r\n   }\r\n\r\n   // elements with a mask value other than \"none\".\r\n   const mask = computedStyle.mask || computedStyle.webkitMask;\r\n   if (mask !== 'none' && mask !== undefined)\r\n   {\r\n      return { node, reason: `mask:  ${mask}` };\r\n   }\r\n\r\n   // elements with a mask-image value other than \"none\".\r\n   const maskImage = computedStyle.maskImage || computedStyle.webkitMaskImage;\r\n   if (maskImage !== 'none' && maskImage !== undefined)\r\n   {\r\n      return { node, reason: `mask-image: ${maskImage}` };\r\n   }\r\n\r\n   // elements with a mask-border value other than \"none\".\r\n   const maskBorder = (computedStyle as any).maskBorder || (computedStyle as any).webkitMaskBorder;\r\n   if (maskBorder !== 'none' && maskBorder !== undefined)\r\n   {\r\n      return { node, reason: `mask-border: ${maskBorder}` };\r\n   }\r\n\r\n   // elements with isolation set to \"isolate\".\r\n   if (computedStyle.isolation === 'isolate')\r\n   {\r\n      return { node, reason: `isolation: ${computedStyle.isolation}` };\r\n   }\r\n\r\n   // transform or opacity in will-change even if you don't specify values for these attributes directly.\r\n   if (computedStyle.willChange === 'transform' || computedStyle.willChange === 'opacity')\r\n   {\r\n      return { node, reason: `willChange: ${computedStyle.willChange}` };\r\n   }\r\n\r\n   // elements with -webkit-overflow-scrolling set to \"touch\".\r\n   if ((computedStyle as any).webkitOverflowScrolling === 'touch')\r\n   {\r\n      return { node, reason: '-webkit-overflow-scrolling: touch' };\r\n   }\r\n\r\n   // an item with a z-index value other than \"auto\".\r\n   if (computedStyle.zIndex !== 'auto')\r\n   {\r\n      const parentStyle = activeWindow.getComputedStyle(node.parentNode as Element);\r\n      // with a flex|inline-flex parent.\r\n      if (parentStyle.display === 'flex' || parentStyle.display === 'inline-flex')\r\n      {\r\n         return { node, reason: `flex-item; z-index: ${computedStyle.zIndex}` };\r\n         // with a grid parent.\r\n      }\r\n      else if (parentStyle.grid !== 'none / none / none / row / auto / auto')\r\n      {\r\n         return { node, reason: `child of grid container; z-index: ${computedStyle.zIndex}` };\r\n      }\r\n   }\r\n\r\n   // contain with a value of layout, or paint, or a composite value that includes either of them\r\n   const contain = computedStyle.contain;\r\n   if (['layout', 'paint', 'strict', 'content'].indexOf(contain) > -1 ||\r\n    contain.indexOf('paint') > -1 ||\r\n    contain.indexOf('layout') > -1\r\n   )\r\n   {\r\n      return { node, reason: `contain: ${contain}` };\r\n   }\r\n\r\n   return getStackingContext(node.parentNode as Element, activeWindow);\r\n}\r\n\r\n/**\r\n * Describes why a stacking context is created.\r\n */\r\nexport type StackingContext = {\r\n   /**\r\n    * A DOM Element.\r\n    */\r\n   node: Element;\r\n\r\n   /**\r\n    * Reason for why a stacking context was created.\r\n    */\r\n   reason: string;\r\n}\r\n","import {\n   ensureNonEmptyIterable,\n   isObject }                 from '#runtime/util/object';\n\nimport { CrossRealm }         from '#runtime/util/realm';\n\n/**\n * Tests the given element against several optional exclusion / inclusion criteria such as CSS classes / IDs, selector\n * matches or a general purpose provided predicate function.\n *\n * @param el - Element to test.\n *\n * @param options - Filter options.\n */\nexport function elementMatchesFilter(el: Element, options: ElementMatchesOptions = {}): boolean\n{\n   if (!CrossRealm.browser.isElement(el)) { return false; }\n\n   if (!isObject(options)) { throw new TypeError(`'options' is not an object.`); }\n\n   // Unpack options.\n   const {\n      excludeClasses,\n      includeClasses,\n      excludeIds,\n      includeIds,\n      selector,\n      excludeSelector,\n      predicate\n   } = options;\n\n   const classList = el.classList;\n   const id = el.id;\n\n   // Exclusions -----------------------------------------------------------------------------------------------------\n\n   if (excludeClasses)\n   {\n      const iter = ensureNonEmptyIterable(excludeClasses);\n      if (iter)\n      {\n         for (const cls of iter)\n         {\n            if (classList.contains(cls)) { return false; }\n         }\n      }\n   }\n\n   if (excludeIds)\n   {\n      const iter = ensureNonEmptyIterable(excludeIds);\n      if (iter)\n      {\n         for (const exId of iter)\n         {\n            if (id === exId) { return false; }\n         }\n      }\n   }\n\n   if (typeof excludeSelector === 'string' && el.matches(excludeSelector)) { return false; }\n\n   // Inclusions -----------------------------------------------------------------------------------------------------\n\n   if (includeClasses)\n   {\n      const iter = ensureNonEmptyIterable(includeClasses);\n      if (iter)\n      {\n         for (const cls of iter)\n         {\n            if (!classList.contains(cls)) { return false; }\n         }\n      }\n   }\n\n   if (includeIds)\n   {\n      const iter = ensureNonEmptyIterable(includeIds);\n      if (iter)\n      {\n         for (const incId of iter)\n         {\n            if (id !== incId) { return false; }\n         }\n      }\n   }\n\n   // Explicit selector check.\n   if (typeof selector === 'string' && !el.matches(selector)) { return false; }\n\n   // Predicate must explicitly return `true` to accept.\n   if (typeof predicate === 'function' && !predicate(el)) { return false; }\n\n   return true;\n}\n\n/**\n * Options for {@link elementMatchesFilter}.\n */\nexport interface ElementMatchesOptions\n{\n   /** Iterable list of CSS classes which disqualify an element. */\n   excludeClasses?: Iterable<string>;\n\n   /** Iterable list of CSS classes an element must contain to be accepted. */\n   includeClasses?: Iterable<string>;\n\n   /** Iterable list of IDs which disqualify an element. */\n   excludeIds?: Iterable<string>;\n\n   /** Iterable list of IDs an element must have to be accepted. */\n   includeIds?: Iterable<string>;\n\n   /** CSS selector an ancestor must match to be accepted. */\n   selector?: string;\n\n   /** CSS selector which disqualifies an element if matched. */\n   excludeSelector?: string;\n\n   /** Custom predicate; must return true for an element to be accepted. */\n   predicate?: (el: Element) => boolean;\n}\n","import { isObject }                    from '#runtime/util/object';\nimport { CrossRealm }                  from '#runtime/util/realm';\n\nimport { getStackingContext }          from './getStackingContext';\n\nimport {\n   type ElementMatchesOptions,\n   elementMatchesFilter }              from './elementMatchesFilter';\n\n/**\n * Provides a data defined mechanism to walk up the DOM parent element chain and return the first ancestor that\n * satisfies multiple filtering rules (stacking context, class, ID, selector, predicate) while optionally limiting\n * traversal depth.\n *\n * @param el - Starting element.\n *\n * @param [options] - Filtering and traversal options.\n *\n * @returns The first acceptable parent element or null.\n */\nexport function findParentElement(el: Element, options: FindParentOptions = {}): Element | null\n{\n   if (!CrossRealm.browser.isElement(el)) { throw new TypeError(`'el' is not a valid Element.`); }\n\n   if (options === void 0)\n   {\n      return el.parentElement;\n   }\n   else if (!isObject(options))\n   {\n      throw new TypeError(`'options' is not an object.`);\n   }\n\n   const {\n      stackingContext,\n      stopAt,\n      maxDepth\n   } = options;\n\n   if (typeof stackingContext === 'boolean' && stackingContext)\n   {\n      const activeWindow: Window | undefined = CrossRealm.browser.getWindow(el);\n\n      let current: Element | null = el.parentElement;\n\n      while (current)\n      {\n         const ctx = getStackingContext(current, activeWindow);\n\n         const next = ctx?.node ?? null;\n\n         if (!next) { return null; }\n\n         // Apply filtering rules.\n         if (elementMatchesFilter(next, options)) { return next; }\n\n         // Continue walking upward through stacking contexts.\n         current = next.parentElement;\n      }\n\n      return null;\n   }\n\n   // Handle direct / normal traversal -------------------------------------------------------------------------------\n\n   if (maxDepth !== void 0 && !Number.isInteger(maxDepth) && maxDepth <= 0)\n   {\n      throw new TypeError(`'maxDepth' is not a positive integer.`);\n   }\n\n   let current = el.parentElement;\n\n   // Depth limit; `Infinity` if not provided.\n   let depth = 0;\n   const limit = maxDepth ?? Infinity;\n\n   while (current && depth <= limit)\n   {\n      // Stop traversal at boundary element.\n      if (stopAt && current === stopAt)\n      {\n         return elementMatchesFilter(current, options) ? current : null;\n      }\n\n      if (elementMatchesFilter(current, options)) { return current; }\n\n      current = current.parentElement;\n      depth++;\n   }\n\n   return null;\n}\n\n/**\n * Options for {@link findParentElement}. The most common options are use of {@link FindParentOptions.stackingContext}\n * and / or the exclusion CSS class / ID properties such as {@link ElementMatchesOptions.excludeClasses}.\n */\nexport interface FindParentOptions extends ElementMatchesOptions\n{\n   /**\n    * When true, traverse parent elements until the stacking context element is found. The stacking context element\n    * will be evaluated against any filter criteria such as inclusion / exclusion rules. If it passes the filter then\n    * it is returned otherwise the next stacking context element is evaluated.\n    *\n    * This option overrides `stopAt` and `maxDepth` options.\n    */\n   stackingContext?: boolean;\n\n   /**\n    * Stops traversal when this element is reached.\n    *\n    * The element itself will still be evaluated against any filter criteria such as inclusion / exclusion rules. If it\n    * passes the filter then it is returned. If it does not pass then `null` is returned.\n    */\n   stopAt?: Element;\n\n   /**\n    * Positive integer defining maximum number of parentElement hops allowed.\n    */\n   maxDepth?: number;\n}\n"],"names":[],"mappings":"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"}