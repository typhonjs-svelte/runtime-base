{"version":3,"file":"index.js","sources":["../../../../../src/svelte/action/dom/inline-svg/index.js"],"sourcesContent":["/**\n * Svelte action for dynamically inlining remote SVG into the DOM using `fetch`.\n *\n * *âš  SECURITY WARNING - XSS RISK*\n * ------------------------------------------------------------\n * This action does NOT sanitize the fetched SVG or remote file. Inline SVG is treated like live DOM and can execute\n * scripts. Untrusted SVG can lead to full cross-site scripting (XSS).\n *\n * Common attack vectors include:\n * ```\n *   - <script> elements\n *   - Event handler attributes: onclick, onload, onmouseover, etc.\n *   - javascript: URLs inside href, xlink:href, style, gradients, filters\n *   - <foreignObject> allowing embedded HTML + JS execution\n *   - External references (remote images, fonts, scripts)\n * ```\n *\n * IMPORTANT:\n * Remote SVG should be considered the same as remote HTML. If you inline untrusted content, you may be executing\n * attacker code.\n *\n * You MUST sanitize SVG content before injecting it into the DOM.\n * Sanitization can be done:\n * ```\n * (1) Server-side, OR\n * (2) In the `transform` function using a trusted sanitizer.\n * ```\n *\n * For client-side sanitization, DOMPurify is strongly recommended: https://github.com/cure53/DOMPurify\n *\n * Additional references on SVG security and XSS vulnerabilities:\n * - MDN - Security considerations for XSS: https://developer.mozilla.org/en-US/docs/Web/Security/Attacks/XSS\n * - OWASP XSS Filter Evasion / SVG Risk Overview: https://owasp.org/www-community/xss-filter-evasion-cheatsheet\n *\n * FAILURE TO SANITIZE SVG MAY RESULT IN REMOTE CODE EXECUTION.\n *\n * @example\n * Basic usage:\n * ```html\n * <script>\n *   import { inlineSvg } from '#runtime/svelte/action/inline-svg';\n * </script>\n *\n * <svg use:inlineSvg={'http://example.com/icon.svg'}></svg>\n * ```\n *\n * @example\n * An example using the `transform` function with `DOMPurify`:\n * ```html\n * <script>\n *   import { inlineSvg } from '#runtime/svelte/action/inline-svg';\n *   import DOMPurify from 'dompurify';\n *\n *   const config = {\n *     src: 'https://example.com/icon.svg',\n *     transform: (remoteData) => {\n *       // Sanitize untrusted SVG before injecting into the DOM.\n *       // Without sanitization, malicious SVG can execute script code.\n *       return DOMPurify.sanitize(remoteData, { USE_PROFILES: { svg: true } });\n *     }\n *   };\n * </script>\n *\n * <!-- The remote SVG (after DOMPurify sanitization) will be inlined here -->\n * <svg use:inlineSvg={config}></svg>\n * ```\n *\n * @param {SVGElement} node - SVGElement to inline SVG into.\n *\n * @param {string | import('./types').InlineSvgOptions} options - A string for `src` / SVG remote URI or a complete\n *        options object.\n *\n * @returns {import('svelte/action').ActionReturn<string | import('./types').InlineSvgOptions>} Action lifecycle\n *          functions.\n *\n * @see [DOMPurify](https://dompurify.com/)\n */\nexport function inlineSvg(node, options)\n{\n   let config = InlineSvgSupport.resolveConfig(options);\n\n   InlineSvgSupport.apply(node, config);\n\n   return {\n      update(update)\n      {\n         config = InlineSvgSupport.resolveConfig(update);\n         InlineSvgSupport.apply(node, config)\n      }\n   };\n}\n\nclass InlineSvgSupport\n{\n   /**\n    * @type {Required<import('./types').InlineSvgOptions>}\n    */\n   static #DEFAULT_INLINE_SVG_ACTION_CONFIG = {\n      autoDimensions: true,\n      cache: 'no-cache',\n      src: '',\n      transform: (svg) => svg,\n   };\n\n   /**\n    * Matches a CSS / SVG dimension: signed decimal or scientific number + optional unit (letters or %).\n    *\n    * @type {RegExp}\n    */\n   static #DIMENSION_REGEX = /^([+-]?(?:\\d+(?:\\.\\d+)?|\\.\\d+)(?:[eE][+-]?\\d+)?)\\s*([a-zA-Z%]+)?$/;\n\n   /**\n    *\n    * @param {SVGElement}  node -\n    *\n    * @param {import('./types').InlineSvgOptions} config -\n    */\n   static async apply(node, config)\n   {\n      if (config.src)\n      {\n         const response = await fetch(config.src, { cache: config.cache });\n         const str = config.transform(await response.text());\n         const svg = new DOMParser().parseFromString(str, 'image/svg+xml').documentElement;\n\n         for (let i = 0; i < svg.attributes.length; i++)\n         {\n            const attr = svg.attributes[i];\n            if (!node.hasAttribute(attr.name) && !['width', 'height'].includes(attr.name))\n            {\n               node.setAttribute(attr.name, attr.value);\n            }\n         }\n\n         if (config.autoDimensions)\n         {\n            const dimensions = this.#calculateDimensions(node, svg);\n            node.setAttribute('width', dimensions.width);\n            node.setAttribute('height', dimensions.height);\n         }\n         else\n         {\n            node.setAttribute('width', node.getAttribute('width') || '');\n            node.setAttribute('height', node.getAttribute('height') || '');\n         }\n\n         node.innerHTML = svg.innerHTML;\n      }\n   }\n\n   /**\n    * Resolve the input parameters of `inlineSvg` action to an internally usable config.\n    *\n    * @param {string | import('./types').InlineSvgOptions | undefined} options\n    *\n    * @returns {Required<import('./types').InlineSvgOptions>} Normalized options.\n    */\n   static resolveConfig(options = '')\n   {\n      if (typeof options === 'string')\n      {\n         return {\n            ...this.#DEFAULT_INLINE_SVG_ACTION_CONFIG,\n            src: options,\n         };\n      }\n\n      return {\n         ...this.#DEFAULT_INLINE_SVG_ACTION_CONFIG,\n         ...options,\n      };\n   }\n\n   // Internal Implementation ----------------------------------------------------------------------------------------\n\n   static #calculateDimensions(local, remote)\n   {\n      const lWidthStr = local.getAttribute('width');\n      const lHeightStr = local.getAttribute('height');\n\n      if (lWidthStr && lHeightStr)\n      {\n         return {width: lWidthStr, height: lHeightStr};\n      }\n\n      const lDimension = { width: lWidthStr || '', height: lHeightStr || '' };\n\n      const rWidthStr = remote.getAttribute('width');\n      const rHeightStr = remote.getAttribute('height');\n      const rViewBox = remote.getAttribute('viewBox');\n\n      if (!((rWidthStr && rHeightStr) || rViewBox))\n      {\n         return lDimension;\n      }\n\n      let rWidth = 0;\n      let rHeight = 0;\n      let rWidthUnit = '';\n      let rHeightUnit = '';\n\n      if (rWidthStr && rHeightStr)\n      {\n         ({ number: rWidth, unit: rWidthUnit } = this.#extractDimensionNumberAndUnit(rWidthStr));\n         ({ number: rHeight, unit: rHeightUnit } = this.#extractDimensionNumberAndUnit(rHeightStr));\n      }\n      else if (rViewBox)\n      {\n         [, , rWidth, rHeight] = rViewBox.split(' ').map((s) => parseInt(s, 10));\n      }\n\n      if (rWidthUnit !== rHeightUnit)\n      {\n         return {\n            width: lWidthStr || rWidthStr || '',\n            height: lHeightStr || rHeightStr || '',\n         };\n      }\n\n      if (lWidthStr)\n      {\n         const {number, unit} = this.#extractDimensionNumberAndUnit(lWidthStr);\n\n         const cDimension = this.#calculateNewDimensions(\n            { width: rWidth, height: rHeight },\n            { width: number },\n         );\n\n         const cUnit = unit || rWidthUnit;\n\n         return {\n            width: cDimension.width.toFixed(2) + cUnit,\n            height: cDimension.height.toFixed(2) + cUnit,\n         };\n      }\n      if (lHeightStr)\n      {\n         const {number, unit} = this.#extractDimensionNumberAndUnit(lHeightStr);\n\n         const cDimension = this.#calculateNewDimensions(\n            { width: rWidth, height: rHeight },\n            { height: number },\n         );\n\n         const cUnit = unit || rHeightUnit;\n\n         return {\n            width: cDimension.width.toFixed(2) + cUnit,\n            height: cDimension.height.toFixed(2) + cUnit,\n         };\n      }\n      return {\n         width: rWidth + rWidthUnit,\n         height: rHeight + rHeightUnit,\n      };\n   }\n\n   /**\n    * @param {{ width: number; height: number }} base - Base dimension\n    *\n    * @param {{ width: number } | { height: number }} constraint - Dimension constraint.\n    *\n    * @returns {{ width: number; height: number }} - Adjusted dimension.\n    */\n   static #calculateNewDimensions(base, constraint)\n   {\n      const { width, height } = base;\n\n      if ('width' in constraint)\n      {\n         const { width: constraintWidth } = constraint;\n         return {\n            width: constraintWidth,\n            height: (constraintWidth / width) * height,\n         };\n      }\n\n      const { height: constraintHeight } = constraint;\n\n      return {\n         width: (constraintHeight / height) * width,\n         height: constraintHeight,\n      };\n   }\n\n   /**\n    * @param {string} dimension -\n    *\n    * @returns {{ number: number; unit: string }} Dimension number / unit.\n    */\n   static #extractDimensionNumberAndUnit(dimension)\n   {\n      const [, num, unit = ''] = dimension.trim().match(this.#DIMENSION_REGEX) ?? [];\n      return { number: parseInt(num, 10), unit };\n   }\n}\n"],"names":[],"mappings":"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"}